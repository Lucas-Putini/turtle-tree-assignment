FROM ghcr.io/aica-technology/ros2-ws:v2.0.6-jazzy

USER ros2

# install specific ROS packages
RUN sudo apt-get update && sudo apt-get install -y \
  ros-$ROS_DISTRO-behaviortree-cpp-v3 \
  ros-$ROS_DISTRO-turtlesim

# fetch additional helper packages for behavior tree integration with ROS 2
RUN git clone --depth 1 --branch humble https://github.com/BehaviorTree/BehaviorTree.ROS2 /home/ros2/ws/src/btcpp

# update ros dependencies based on the additional package requirements
RUN rosdep update && rosdep install --from-paths /home/ros2/ws/src --ignore-src -y

# create a symbolic link for an autogenerated header file to fix a build issue in the source repo
RUN ln -s /home/ros2/ws/build/behaviortree_ros2/bt_executor_parameters/include/bt_executor_parameters.hpp /home/ros2/ws/src/btcpp/behaviortree_ros2/include/behaviortree_ros2

# set the shell to bash (not)
SHELL ["/bin/bash", "-c"]

# configure and build the workspace
RUN source /opt/ros/jazzy/setup.bash && cd /home/ros2/ws && colcon build

# ensure the workspace environment is sourced hereafter
RUN echo "source /home/ros2/ws/install/setup.bash" >> /home/ros2/.bashrc