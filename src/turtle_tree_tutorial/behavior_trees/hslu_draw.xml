<root BTCPP_format="4">
  <BehaviorTree ID="Main">
    <Sequence>
      <Talker message="Starting HSLU drawing"/>

      <!-- H -->
      <Talker message="Drawing H"/>
      <SetPenTurtle service_name="/turtle1/set_pen" r="245" g="245" b="245" width="3" off="1"/>
      <Fallback>
        <Sequence>
          <Talker message="[H][TRY-A] Checking if turtle1 is already at start pose"/>
          <CheckTurtlePose topic_name="/turtle1/pose" x="1.1" y="8.8" theta="0.0" linear_distance="0.05" angular_distance="0.2"/>
          <Talker message="[H][TRY-A] SUCCESS -> no correction needed"/>
        </Sequence>
        <Sequence>
          <Talker message="[H][TRY-B] TRY-A failed -> applying correction move"/>
          <MoveTurtleAbsolute service_name="/turtle1/teleport_absolute" x="1.1" y="8.8" theta="0.0"/>
          <Talker message="[H][TRY-B] Validating corrected pose"/>
          <CheckTurtlePose topic_name="/turtle1/pose" x="1.1" y="8.8" theta="0.0" linear_distance="0.05" angular_distance="0.2"/>
          <Talker message="[H][TRY-B] SUCCESS -> correction branch finished"/>
        </Sequence>
      </Fallback>
      <SetPenTurtle service_name="/turtle1/set_pen" r="245" g="245" b="245" width="3" off="0"/>
      <PatchedDelay delay_msec="170">
        <MoveTurtleAbsolute service_name="/turtle1/teleport_absolute" x="1.1" y="2.4" theta="0.0"/>
      </PatchedDelay>
      <SetPenTurtle service_name="/turtle1/set_pen" r="245" g="245" b="245" width="3" off="1"/>
      <PatchedDelay delay_msec="120">
        <MoveTurtleAbsolute service_name="/turtle1/teleport_absolute" x="1.1" y="5.6" theta="0.0"/>
      </PatchedDelay>
      <SetPenTurtle service_name="/turtle1/set_pen" r="245" g="245" b="245" width="3" off="0"/>
      <PatchedDelay delay_msec="170">
        <MoveTurtleAbsolute service_name="/turtle1/teleport_absolute" x="2.3" y="5.6" theta="0.0"/>
      </PatchedDelay>
      <SetPenTurtle service_name="/turtle1/set_pen" r="245" g="245" b="245" width="3" off="1"/>
      <PatchedDelay delay_msec="120">
        <MoveTurtleAbsolute service_name="/turtle1/teleport_absolute" x="2.3" y="8.8" theta="0.0"/>
      </PatchedDelay>
      <SetPenTurtle service_name="/turtle1/set_pen" r="245" g="245" b="245" width="3" off="0"/>
      <PatchedDelay delay_msec="170">
        <MoveTurtleAbsolute service_name="/turtle1/teleport_absolute" x="2.3" y="2.4" theta="0.0"/>
      </PatchedDelay>
      <PatchedDelay delay_msec="240">
        <Talker message="H done"/>
      </PatchedDelay>

      <!-- S -->
      <Talker message="Drawing S"/>
      <SetPenTurtle service_name="/turtle2/set_pen" r="40" g="220" b="90" width="3" off="1"/>
      <Fallback>
        <Sequence>
          <Talker message="[S][TRY-A] Checking if turtle2 is already at start pose"/>
          <CheckTurtlePose topic_name="/turtle2/pose" x="5.2" y="8.8" theta="0.0" linear_distance="0.05" angular_distance="0.2"/>
          <Talker message="[S][TRY-A] SUCCESS -> no correction needed"/>
        </Sequence>
        <Sequence>
          <Talker message="[S][TRY-B] TRY-A failed -> applying correction move"/>
          <MoveTurtleAbsolute service_name="/turtle2/teleport_absolute" x="5.2" y="8.8" theta="0.0"/>
          <Talker message="[S][TRY-B] Validating corrected pose"/>
          <CheckTurtlePose topic_name="/turtle2/pose" x="5.2" y="8.8" theta="0.0" linear_distance="0.05" angular_distance="0.2"/>
          <Talker message="[S][TRY-B] SUCCESS -> correction branch finished"/>
        </Sequence>
      </Fallback>
      <SetPenTurtle service_name="/turtle2/set_pen" r="40" g="220" b="90" width="3" off="0"/>
      <!-- S with 5 straight segments (blocky style) -->
      <PatchedDelay delay_msec="170">
        <MoveTurtleAbsolute service_name="/turtle2/teleport_absolute" x="3.7" y="8.8" theta="0.0"/>
      </PatchedDelay>
      <PatchedDelay delay_msec="170">
        <MoveTurtleAbsolute service_name="/turtle2/teleport_absolute" x="3.7" y="6.4" theta="0.0"/>
      </PatchedDelay>
      <PatchedDelay delay_msec="170">
        <MoveTurtleAbsolute service_name="/turtle2/teleport_absolute" x="5.2" y="6.4" theta="0.0"/>
      </PatchedDelay>
      <PatchedDelay delay_msec="170">
        <MoveTurtleAbsolute service_name="/turtle2/teleport_absolute" x="5.2" y="2.4" theta="0.0"/>
      </PatchedDelay>
      <PatchedDelay delay_msec="170">
        <MoveTurtleAbsolute service_name="/turtle2/teleport_absolute" x="3.7" y="2.4" theta="0.0"/>
      </PatchedDelay>
      <PatchedDelay delay_msec="240">
        <Talker message="S done"/>
      </PatchedDelay>

      <!-- L -->
      <Talker message="Drawing L"/>
      <SetPenTurtle service_name="/turtle3/set_pen" r="255" g="205" b="20" width="3" off="1"/>
      <Fallback>
        <Sequence>
          <Talker message="[L][TRY-A] Checking if turtle3 is already at start pose"/>
          <CheckTurtlePose topic_name="/turtle3/pose" x="6.2" y="8.8" theta="0.0" linear_distance="0.05" angular_distance="0.2"/>
          <Talker message="[L][TRY-A] SUCCESS -> no correction needed"/>
        </Sequence>
        <Sequence>
          <Talker message="[L][TRY-B] TRY-A failed -> applying correction move"/>
          <MoveTurtleAbsolute service_name="/turtle3/teleport_absolute" x="6.2" y="8.8" theta="0.0"/>
          <Talker message="[L][TRY-B] Validating corrected pose"/>
          <CheckTurtlePose topic_name="/turtle3/pose" x="6.2" y="8.8" theta="0.0" linear_distance="0.05" angular_distance="0.2"/>
          <Talker message="[L][TRY-B] SUCCESS -> correction branch finished"/>
        </Sequence>
      </Fallback>
      <SetPenTurtle service_name="/turtle3/set_pen" r="255" g="205" b="20" width="3" off="0"/>
      <PatchedDelay delay_msec="170">
        <MoveTurtleAbsolute service_name="/turtle3/teleport_absolute" x="6.2" y="2.4" theta="0.0"/>
      </PatchedDelay>
      <PatchedDelay delay_msec="170">
        <MoveTurtleAbsolute service_name="/turtle3/teleport_absolute" x="7.8" y="2.4" theta="0.0"/>
      </PatchedDelay>
      <PatchedDelay delay_msec="240">
        <Talker message="L done"/>
      </PatchedDelay>

      <!-- U -->
      <Talker message="Drawing U"/>
      <SetPenTurtle service_name="/turtle4/set_pen" r="70" g="190" b="255" width="3" off="1"/>
      <Fallback>
        <Sequence>
          <Talker message="[U][TRY-A] Checking if turtle4 is already at start pose"/>
          <CheckTurtlePose topic_name="/turtle4/pose" x="8.7" y="8.8" theta="0.0" linear_distance="0.05" angular_distance="0.2"/>
          <Talker message="[U][TRY-A] SUCCESS -> no correction needed"/>
        </Sequence>
        <Sequence>
          <Talker message="[U][TRY-B] TRY-A failed -> applying correction move"/>
          <MoveTurtleAbsolute service_name="/turtle4/teleport_absolute" x="8.7" y="8.8" theta="0.0"/>
          <Talker message="[U][TRY-B] Validating corrected pose"/>
          <CheckTurtlePose topic_name="/turtle4/pose" x="8.7" y="8.8" theta="0.0" linear_distance="0.05" angular_distance="0.2"/>
          <Talker message="[U][TRY-B] SUCCESS -> correction branch finished"/>
        </Sequence>
      </Fallback>
      <SetPenTurtle service_name="/turtle4/set_pen" r="70" g="190" b="255" width="3" off="0"/>
      <PatchedDelay delay_msec="170">
        <MoveTurtleAbsolute service_name="/turtle4/teleport_absolute" x="8.7" y="2.4" theta="0.0"/>
      </PatchedDelay>
      <PatchedDelay delay_msec="170">
        <MoveTurtleAbsolute service_name="/turtle4/teleport_absolute" x="10.0" y="2.4" theta="0.0"/>
      </PatchedDelay>
      <PatchedDelay delay_msec="170">
        <MoveTurtleAbsolute service_name="/turtle4/teleport_absolute" x="10.0" y="8.8" theta="0.0"/>
      </PatchedDelay>
      <SetPenTurtle service_name="/turtle4/set_pen" r="70" g="190" b="255" width="3" off="1"/>

      <Talker message="Finished HSLU drawing"/>
    </Sequence>
  </BehaviorTree>
</root>
